## 整体来看

STM32 的启动过程是指从 CPU 上电复位执行第 1 条指令开始到进入 C 程序 main()函数入口之间的部分。

![image-20210506090452959](https://gitee.com/wang_chunfeng/pic-go/raw/master/img/20210506090501.png)

复位序列 硬件复位之后，就是按下复位开关后。CPU 内的时序逻辑电路首先完成如下两个工作（程序代码下载到内部flash为例，flash首地址 0x0800 0000）

- 将 0x08000000 位置存放的堆栈栈顶地址存放到 SP 中(MSP)。
- 将 0x08000004 位置存放的向量地址装入 PC 程序计数器。

CPU 从 PC 寄存器指向的物理地址取出第 1 条指令开始执行程序，也就是开始执行复位中断服务程序 Reset_Handler。复位中断服务程序会调用SystemInit()函数来配置系统时钟、配置FMC总线上的外部SRAM/SDRAM，然后跳转到 C 库中__main 函数。由 C 库中的__main 函数完成用户程序的初始化工作（比如：变量赋初值等），最后由__main 函数调用用户写的 main()函数开始执行 C 程序。

## 启动中设置的系统时钟

如果是固件库版本，则一般 在启动文件中会调用时钟设置，ST官方会提供SystemInit（）函数，可以专门针对stm32f103系列芯片，对芯片时钟进行设定。启动文件是汇编，会在其中调用固件库的函数！！与时钟有关的函数都在stm32f10x_rcc.c中实现。