## IIC

我比较喜欢把IIC分两个层去理解，硬件层和软件层。

### 硬件层

从硬件层来看，它有两条线，数据线SDA，时钟线SCL。它们内部都使用漏极开路驱动器（开漏驱动），因此SDA和SCL 可以被拉低为低电平，但是不能被驱动为高电平，所以每条线上都要使用一个上拉电阻，默认情况下将其保持在高电平。同时只能一方发一方收，所以它是同步串行的半双工总线。同时IIC也规定了速度，100K、400K、3.4M，分别对应标准、快速、高速模式。

### 协议层

在协议层来看，IIC是这样规定的，数据在SCL为高电平时，进行读取数据，此时的数据有效。所以：

+ 开始信号：SCL为高，SDA被拉低，然后SCL被拉低。
+ 停止信号：SCL为高，SDA被拉高，然后SCL被拉低。
+ 应答信号：在第9个时钟信号，从设备拉低SDA表示应答；无应答则是从设备不动SDA，SDA为高。此时则会导致通信结束或者设备重启。
+ 写数据：起始信号+等待响应+地址（附带读写方向，0表示写数据）+ 等待回复+一个字节的数据+等待回复...发送停止信号
+ 读数据：起始信号+等待响应+地址（附带读写方向，1表示读数据）+ 等待回复+一个字节的数据+发送应答...发送非应答，停止接收
+ 读写复合：包括两段起始信号。起始信号+等待响应+地址（写）+等待回复+数据（从机内部地址）+起始信号......

## SPI

我也把它分为硬件层和协议层来看。
### 硬件层

在硬件层，它有四根线，SS：片选线。SCK：时钟信号线。MOSI:主机数据输出。MISO:主机数据接收

这种设计让一个主机可接多个从机，我们也可以知道它是同步串行的全双工通信总线。

### 协议层

在协议层，SS线为低电平的时候，数据有效，开始传输。

+   SPI有四种工作模式：
	
+   模式0与模式3使用较多
	
+ 需要根据外设工作要求，来进行一个配置，因该要仔细阅读数据手册来确定。（其输出**串行同步时钟**的**极性**和**相位**可以进行配置）。

  | SPI模式 | CPOL | CPHA | 空闲时SCK时钟 | 采样时刻                             |
  | ------- | ---- | ---- | ------------- | ------------------------------------ |
  | 0       | 0    | 0    | 低电平        | 第一个跳变沿 (上升或下降) 数据被采样 |
  | 1       | 0    | 1    | 低电平        | 第二个跳变沿 (上升或下降) 数据被采样 |
  | 2       | 1    | 0    | 高电平        | 第二个跳变沿 (上升或下降) 数据被采样 |
  | 3       | 1    | 1    | 高电平        | 第一个跳变沿 (上升或下降) 数据被采样 |

## UART

我们还是分为两个部分来看。

### 硬件层	

在硬件层，一共有三根线，RX收，TX发，还有一个GND。由此可见，它是异步串行的全双工通信总线。

### 协议层

在协议层：

+ 起始位：不传输数据时保持在高电平，开始时发送端拉低传输线。当接收端UART检测到高电压到低电压转换时，它开始以波特率的频率读取数据位中的每一位数据。
+ 停止位：发送端拉高发送数据线至少持续两位数据的时间宽度来表示结束。同时停止位也表示一个小小的校正。
+ 数据：一般为5~8位，可以根据需要设定。在大多数情况下，数据首先以低有效位发送。
+ 校验方法有奇校验(odd)、偶校验(even)、 0 校验(space)、 1 校验(mark)以及无校验(noparity)
  + 奇校验要求有效数据和校验位中“1”的个数为奇数，偶校验反之

+ 通信双方需要设定好数据格式，如校验位，数据位，停止位，波特率等才能正常收发。

### 波特率

每秒传输二进制的位数。115200-->每秒传输115200bit。如果系统时钟为50MH，则传输1bit需要计数50*10^6/115200。

所以波特率设置本质就是调节时钟周期的计数个数，重装载数，不同的单片机设置方法不同。

### UART的物理层（其他UART）
UART、RS232、RS485在串口通信中，主要区别是电平的不同，其中UART通常使用TTL电平，下面介绍这几个存在的差异；

+ TTL
TTL全名是晶体管-晶体管逻辑集成电路(Transistor-Transistor Logic)
输入高电平最小2V，输出高电平最小2.4V，典型值3.4V；
输入低电平最大0.8V，输出低电平最大0.4V，典型值0.2V。

+ RS232
RS232 逻辑1电平(MARK)=**-3V～-15V（负数）**，逻辑0电平(SPACE)=+3～+15V；

+ RS485
RS485是差分信号进行串行传输；
逻辑1以两线间的电压差为+(2~6)V表示；
逻辑"0"以两线间的电压差为-(2~6)V表示；

+ 在工业通信中，使用RS485比较多，因为RS485是差分信号，可以抑制共模干扰，因此在恶劣的环境中拥有很好的抗干扰性，比较稳定；