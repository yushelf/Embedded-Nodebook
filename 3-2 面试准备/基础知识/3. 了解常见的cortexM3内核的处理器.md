## MCU怎么选型，STM32F1和F4有什么区别

选型：

> 参考各个公司的选型手册，结合项目需求进行选型，同时现在芯片缺货严重，也要考虑到供货是否稳定等因素。例如我的那个振动检测项目，当时客户要求要做低功耗，同时考虑到软件并不是很复杂，公司之前又用过华大的芯片，于是我们决定选用cortexM0内核的芯片，就延用了之前的型号，使用的是HC32L110。

区别：

1. 内核不同F1是M3的内核，F4是M4的内核。
2. 主频不同，F1最高只有72M，F4最高可到168M。
3. Flash和RAM的容量差别，F1的Flash范围为16K-1024K，RAM为4K-80K；F4的Flash范围为128K-2048K，RAM为64K-256K；
4. 价格上F4明先会偏高。



## stm32的一些芯片的配置吗？CPU主频，flash和RAM分别都是多大的？

**STM32**系列基于专为要求高性能、低成本、低功耗的嵌入式应用专门设计的ARM控制器。

我们以**STM32F103**为例，其具备以下资源：

- 内核：**ARM32位Cortex-M3** CPU，最高工作频率72MHz

- 存储器：片上集成512KB的Flash存储器。6-64KB的SRAM存储器。

- 低功耗：3种低功耗模式：休眠，停止，待机模式。

- 2个12位的us级的AD转换器（模数转换16通道）：AD测量范围：0-3.6 V。双采样和保持能力。

  

## 外部RAM和内部RAM区别，怎么分配

外部有2层含义
1.物理上：在mcu外部
2.分类上：区别于cache、iram的称呼
区别：
物理上的外部ram，由于受到外部线路干扰，访问速度会慢于内部构件的“外部ram”
分类上的外部ram，有些架构和内部没有区别，有些架构（比如MCS51）访问指令不同于“内部ram”



## MCU上的固件，数据是怎么分配的

### flash

代码和数据都存于flash。
对于ARM Cortex M3来说，Flash中可以分为，文本段（代码+常量），只读数据区，复制区（存放初始化为非零的全局变量的值）全局变量是存放在 RAM 上的，RAM 上的值掉电便丢失，每次上电后这些变量是要进行重新赋值的，而重新赋的值就存放在这里。那为什么不存放初始化为 0 的全局变量初始值呢，原因也很简单，既然是初始化为 0,那么在上电后统一对存放初始化为 0 的全局变量的那块区域清0就好了。

![微信图片_20210216181513](https://gitee.com/wang_chunfeng/pic-go/raw/master/img/20210908101233.jpg)

### RAM

STM32单片机的片内RAM会被链接文件分区”为如下几个段：

“![微信图片_20210216182053](https://gitee.com/wang_chunfeng/pic-go/raw/master/img/20210908101233.jpg)

+ 栈 (Stack) : 存放局部变量和函数调用时的返回地址
+ 堆 (heap) : 由 malloc 申请，由 free 释放
+ bss : 存放未初始化或者是初始化为 0 的全局变量、全局静态变量和局部静态变量
+ data : 存放已经初始化的非0的全局变量、全局静态变量和局部静态变量



## MCU启动流程

STM32 的启动过程是指从 CPU 上电复位执行第 1 条指令开始到进入 C 程序 main()函数入口之间的部分。

![image-20210506090452959](https://gitee.com/wang_chunfeng/pic-go/raw/master/img/20210908101246.png)

复位序列 硬件复位之后，就是按下复位开关后。CPU 内的时序逻辑电路首先完成如下两个工作（程序代码下载到内部flash为例，flash首地址 0x0800 0000）

- 将 0x08000000 位置存放的堆栈 c栈顶地址存放到 SP 中(MSP)。
- 将 0x08000004 位置存放的向量地址装入 PC 程序计数器。

CPU 从 PC 寄存器指向的物理地址取出第 1 条指令开始执行程序，也就是开始执行复位中断服务程序 Reset_Handler。复位中断服务程序会调用SystemInit()函数来配置系统时钟、配置FMC总线上的外部SRAM/SDRAM，然后跳转到 C 库中__main 函数。由 C 库中的__main 函数完成用户程序的初始化工作（比如：变量赋初值等），最后由__main 函数调用用户写的 main()函数开始执行 C 程序。