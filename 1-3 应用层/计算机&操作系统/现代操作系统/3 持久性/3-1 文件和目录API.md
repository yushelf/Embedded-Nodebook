## 文件和目录

**文件：**文件就是一个线性字节数组，每个字节可以读取和写入，每个文件都有一个和它关联的inode号

**目录：**每个目录都有一个inode号，同时它包含一个对的列表，每个inode和用户可读名一一映射，目录中每个条目都指向其他文件或目录，以此来构建任意的目录树。 

## 文件
### 创建文件

```c
int fd = open("foo",O_CREAT|O_WRONLY|O_TRUNC);
```

open函数的返回值是一个文件描述符，每个进程私有，它是一种权限，不透明的句柄，可以让你执行某些操作，也可以看作指向这个文件的指针。

### 读写文件

```c
read(文件描述符,"（指向放置read结果的缓冲区）",（缓冲区大小）);
writte(文件描述符,“（指向要写入的内容）”,（内容大小）);
```

对于文件读写的操作，需要先打开该文件，使用完后需要关闭该文件。

一般一个进程，打开的第一个文件的描述符是3。因为0是标准输入，1是标准输出，2是标准错误。

### 文件写入偏移

```c
off_t lseek(int fildes,off_t offset,int whence);
```

一般调用读写函数都会隐式的更新偏移量，而这个函数则是明显的改变偏移量。它知识改变内核中变量的值，不会直接导致磁盘的io自动发生。

### 立即写入

```c
fsync();
```

避免文件系统将write的内容写入在内存中的缓冲，直接写入磁盘，避免安全隐患。

### 文件重命名

```c
rename(char *old,char *new);
```

它式一个原子调用，不论系统是否崩溃，调用只有两种结果，成果或者不成功，不会有奇怪的中间状态。

## 目录

### 创建目录

````c
mkdir("",);
````

创建空目录时，会有两个条目，一个引用自身的条目，一个引用父目录的条目，前者称为”.“，后者称为”..“。

### 读取目录

使用opendir()、readdir()、closedir()三个调用即可完成目录读取，使用一个简单的循环即可。

```c
int main(int argc,char *argv[])//打印目录下的所有信息
{
	DIR *dp = opendir(".");
	assert(dp != NULL);
	struct dirent *d;
	while((d = readdir(dp)) != NULL)
	{
		printf("%d %s\n",(int) d->d_ino,d->d_name);
	}
	closedir(dp);
	return 0;
}
```

### 删除目录

```
rmdir();
```

只能删除空目录，否则会删除失败。

## 文件与目录

### 硬链接

 
