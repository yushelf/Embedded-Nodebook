# 机制：受限直接执行

构建虚拟化机制时，需要考虑新能和控制权。保证不额外增加系统开销以及保留对CPU地控制权。

## 受限制的操作

需要硬件提供相关支持，如陷阱表（类似中断向量表）。可以通过陷阱表回到内核模式，这样能隔离用户程序，对内核以及内存进行一个保护。下图为整个的工作流程。

![image-20210616160848185](assets/image-20210616160848185.png)

## 线程之间的切换

类似于UCOS，使用到了上下文保存，同时在系统时钟中断中可以获得CPU的控制权，也可以在其中进行调度。